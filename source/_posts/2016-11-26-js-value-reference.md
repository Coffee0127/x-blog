---
title: ç•«åœ–ç†è§£ JavaScript value reference
categories: JavaScript
toc: false
date: 2016-11-26 23:49:27
tags:
    - JavaScript
    - Must-Know
---
é€™ç¯‡æ˜¯ä¸Šå®Œ[ä¿å“¥](https://www.facebook.com/will.fans)çš„ã€ŠJavaScript é–‹ç™¼å¯¦æˆ°ï¼šæ ¸å¿ƒæ¦‚å¿µç¯‡ã€‹ç­†è¨˜ä¹‹ä¸€ ~~(ç‹€æ…‹é¡¯ç¤ºç‚ºæ‹–ç¨¿)~~

é–‹å§‹ä¹‹å‰å¯ä»¥å…ˆçœ‹çœ‹ Stack Overflow ä¸Šé€™ç¯‡ [Is JavaScript a pass-by-reference or pass-by-value language?](http://stackoverflow.com/questions/518000/is-javascript-a-pass-by-reference-or-pass-by-value-language)

çœ‹å®Œç¨‹å¼ç¢¼å¥½æƒ³æœ‰é»æ„Ÿè¦ºï¼Œä½†çœŸç›¸æ˜¯ä»èˆŠä»€éº¼éƒ½ä¸æ‡‚ (ï¿£â–¡ï¿£|||)a

ä»¥ä¸‹å°±ç”¨ä¿å“¥å«¡å‚³ç•«åœ–ç†è§£ä¾†åšèªªæ˜ ã„Ÿ(ï¿£â–½ï¿£ã„Ÿ)

---
#### â€œç‰©ä»¶æ˜¯è¨˜æ†¶é«”ä¸­çš„è³‡æ–™ï¼Œè·Ÿè®Šæ•¸é—œè¯ï¼Œä¸¦åœ¨åŸ·è¡Œæ™‚æœŸæ“æœ‰å‹åˆ¥â€

é–‹å§‹ä¹‹å‰ï¼Œå…ˆæº–å‚™ç´™ç­†ç¹ªå‡ºä»¥ä¸‹æ¨£æ¿

{% img inline /2016/11/26/js-value-reference/layout.jpg %}

å¤§è‡´å¯åˆ†ç‚ºå…©å€å¡Šï¼š
1. ç¨‹å¼ç¢¼å€å¡Šï¼šå°±æ˜¯ç”¨ä¾†å¯« JavaScript ç¨‹å¼ç¢¼çš„...XD
2. è®Šæ•¸ã€è¨˜æ†¶é«”ç©ºé–“ã€å‹åˆ¥ï¼šèªªæ˜â€œç‰©ä»¶æ˜¯**è¨˜æ†¶é«”ä¸­çš„è³‡æ–™**ï¼Œè·Ÿ**è®Šæ•¸**é—œè¯ï¼Œä¸¦åœ¨åŸ·è¡Œæ™‚æœŸæ“æœ‰**å‹åˆ¥**â€

---
åœ¨ä»¥ä¸‹ç¨‹å¼ç¢¼ç‰‡æ®µåŸ·è¡Œçš„éç¨‹ä¸­ï¼Œå‡ºç¾éå¹¾å€‹ç‰©ä»¶ï¼Ÿå¹¾å€‹è®Šæ•¸ï¼Ÿå¹¾ç¨®å‹åˆ¥ï¼Ÿ
```js
var a;
a = 1;
a = "a";
a = "a" + a;
```
æ¥ä¸‹ä¾†å°±å°‡ç¨‹å¼ç¢¼ä¸€æ­¥ä¸€æ­¥å¯«ä¸‹ï¼Œä¸¦ç¹ªè£½å°æ‡‰åœ–å½¢ï½

1. åœ¨ç¨‹å¼ç¢¼å€å¡Šå¯«ä¸Š `var a`ï¼Œä¸¦æ–¼è®Šæ•¸ç•«ä¸Š aï¼Œå› ç‚ºæ²’çµ¦å€¼å› æ­¤æ˜¯ `undefined`ï¼Œé‚£ `undefined` çš„å‹åˆ¥å« `undefined`
{% img inline /2016/11/26/js-value-reference/ex1-1.jpg %}

2. å°‡ 1 assign çµ¦ aï¼Œå› æ­¤è¨˜æ†¶é«”å…§æœƒç”¢ç”Ÿå‹åˆ¥ç‚º `number` çš„ `1`ï¼Œä¸¦ä¸”è®Šæ•¸ `a` æŒ‡å‘ `1`
{% img inline /2016/11/26/js-value-reference/ex1-2.jpg %}

3. å°‡å­—ä¸² a assign çµ¦ aï¼Œå› æ­¤è¨˜æ†¶é«”å…§æœƒç”¢ç”Ÿå‹åˆ¥ç‚º `string` çš„ `a`ï¼Œä¸¦ä¸”è®Šæ•¸ `a` æŒ‡å‘ `a`ï¼›è€ŒåŸæœ¬çš„ `1` å‰‡æœƒè¢« GC (Garbage Collection)ï¼Œå› æ­¤æ”¹ç‚ºè™›ç·š
{% img inline /2016/11/26/js-value-reference/ex1-3.jpg %}

4. ç­‰è™Ÿå³é‚Šå…ˆåŸ·è¡Œï¼Œå› æ­¤è¨˜æ†¶é«”å…§æœƒå†ç”¢ç”Ÿå¦ä¸€å‹åˆ¥ç‚º `string` çš„ `a` (JavaScript æ²’æœ‰æ‰€è¬‚å­—ä¸²æ± è§€å¿µï¼Œå› æ­¤æœƒç”¢ç”Ÿæ–°çš„å­—ä¸²)ï¼Œä¸¦ä¸”è·ŸåŸæœ¬è®Šæ•¸ `a` æŒ‡å‘çš„å­—ä¸² `a` ç›¸åŠ å¾Œç”¢ç”Ÿæ–°çš„å­—ä¸² `aa`
{% img inline /2016/11/26/js-value-reference/ex1-4.jpg %}

5. ä¸¦å°‡æ–°ç”¢ç”Ÿçš„å­—ä¸² `aa` assign çµ¦ a (åŸæœ¬è®Šæ•¸ `a` æŒ‡å‘çš„å­—ä¸² `a` åŠæ–°ç”¢ç”Ÿçš„å­—ä¸² `a` éƒ½æœƒè¢« GC)
{% img inline /2016/11/26/js-value-reference/ex1-5.jpg %}

6. æœ€å¾Œæ•´ç†ä¸€ä¸‹åœ–å½¢
{% img inline /2016/11/26/js-value-reference/ex1-6.jpg %}
è¨ˆç®—ä¸€ä¸‹å³å¯å¾—çŸ¥ç¨‹å¼ç¢¼åŸ·è¡Œéç¨‹ä¸­ï¼Œä¸€å…±ç”¢ç”Ÿäº† 5 å€‹ç‰©ä»¶ã€1 å€‹è®Šæ•¸ã€3 å€‹å‹åˆ¥ <( â€µâ–½â€²)b good job

**è«‹æ³¨æ„ `undefined` ä¸¦ä¸æœƒè¢« GCï¼** å› ç‚ºæ°¸é æœ‰å€‹è®Šæ•¸æŒ‡å‘ `undefined`ï¼Œå³ `window.undefined`

---
æ¥ä¸‹ä¾†çœ‹çœ‹**ç‰©ä»¶**çš„åœ–å½¢åˆæ‡‰è©²æ€éº¼ç•«

```js
window.myKey = 1;
window.myKey = 2;
```

1. å¦‚æ³•ç‚®è£½å…ˆå¯«ä¸Šç¨‹å¼ç¢¼ `window.myKey = 1` ä»¥åŠç•«ä¸Šè®Šæ•¸ `window`ï¼Œé€™é‚Šæ¯”è¼ƒä¸ä¸€æ¨£çš„æ˜¯åœ¨è¨˜æ†¶é«”ç©ºé–“å…§é™¤äº†ç”¨ç‰©ä»¶çš„è¡¨ç¤ºæ³•å¤–ï¼Œå€¼çš„éƒ¨åˆ†æ˜¯å¦å¤–æŒ‡å‘è¨˜æ†¶é«”ç©ºé–“çš„è³‡æ–™
{% img inline /2016/11/26/js-value-reference/ex2-1.jpg %}

2. å°‡ 2 assign çµ¦ myKeyï¼Œå› æ­¤è¨˜æ†¶é«”å…§æœƒç”¢ç”Ÿå‹åˆ¥ç‚º `number` çš„ `2`ï¼Œä¸¦ä¸”è®Šæ•¸ `myKey` æŒ‡å‘ `2`ï¼›è€ŒåŸæœ¬çš„ `1` å‰‡æœƒè¢« GC
{% img inline /2016/11/26/js-value-reference/ex2-2.jpg %}

3. æœ€å¾Œæ•´ç†ä¸€ä¸‹åœ–å½¢
{% img inline /2016/11/26/js-value-reference/ex2-3.jpg %}

---
çœ‹å®Œä»¥ä¸Šå…©å€‹ç¯„ä¾‹ï¼Œæ‡‰è©²ç¨å¾®äº†è§£åœ–å½¢æ‡‰è©²æ€éº¼ç•«ï¼Œå†ä¾†å°±æ˜¯è¦å¤šç·´ç¿’å›‰ï½

```js
var a = { a1: 1, a2: 2 };
var b = [];
b.push(a);
b.push(a);
b[0]['a1'] = 2;
// b[1]['a1'] = ???
```

1. ç•«ä¸Šè®Šæ•¸ `a` ã€æŒ‡å‘çš„ç‰©ä»¶åŠç‰©ä»¶çš„å€¼
{% img inline /2016/11/26/js-value-reference/ex3-1.jpg %}

2. ç•«ä¸Šè®Šæ•¸ `b` åŠæŒ‡å‘çš„é™£åˆ— (æ³¨æ„åˆ° `Array` çš„å‹åˆ¥ä»èˆŠæ˜¯ `object` )
{% img inline /2016/11/26/js-value-reference/ex3-2.jpg %}

3. åœ¨é™£åˆ— `b` åŠ å…¥å…©æ¬¡ `a`
{% img inline /2016/11/26/js-value-reference/ex3-3.jpg %}

4. å°‡é™£åˆ— `b` ç¬¬ä¸€å€‹å…ƒç´ çš„ `a1` çš„å€¼æŒ‡å‘ `2`ï¼›è€ŒåŸæœ¬çš„ `1` å‰‡æœƒè¢« GC
{% img inline /2016/11/26/js-value-reference/ex3-4.jpg %}

5. æœ€å¾Œæ•´ç†ä¸€ä¸‹åœ–å½¢ï¼Œå³å¯å¾—çŸ¥ `b[1]['a1']` æ˜¯æŒ‡å‘ `2`
{% img inline /2016/11/26/js-value-reference/ex3-5.jpg %}

---
æ›´å¤šçš„ç·´ç¿’é¡Œï½

* Example 1
```js
var a = { a1: 1, a2: 2 };
var b = [];
b.push(a);
b[0]['a1'] = 2;
// a['a1'] = ???
```
    {% img inline /2016/11/26/js-value-reference/ex4-1.jpg %}

* Example 2
```js
var a = { x: 1 };
var b = a;
a = { x: 2 };
// b.x = ???
```
    {% img inline /2016/11/26/js-value-reference/ex5-1.jpg %}
    1. è®Šæ•¸ `a` æŒ‡å‘æ–°çš„ç‰©ä»¶ `{ x: 2 }`ï¼Œå› æ­¤ä¸å½±éŸ¿è®Šæ•¸ `b.x`
    2. å› ç‚ºè®Šæ•¸ `b` ä»æŒ‡å‘ç‰©ä»¶ `{ x: 1 }` ï¼Œå› æ­¤ç‰©ä»¶ `{ x: 1 }` ä¸æœƒè¢« GC

* Example 3
```js
var a = { a1: 1, a2: 2 };
function test(p) {
  p.a1 = 2;
}
test(a);
// a.a1 = ???
```
    {% img inline /2016/11/26/js-value-reference/ex6-1.jpg %}
    1. è®Šæ•¸ `p` å› ç‚ºæ˜¯å®£å‘Šåœ¨ `function` å…§ï¼Œå› æ­¤ç•¶ `function` åŸ·è¡Œå®Œç•¢æœƒè¢«éŠ·æ¯€

* Example 4
```js
var a = 1;
function test(p) {
  p = 2;
}
test(a);
// a = ???
```
    {% img inline /2016/11/26/js-value-reference/ex7-1.jpg %}
    1. è®Šæ•¸ `p` æŒ‡å‘çš„ `1` è·ŸåŸæœ¬è®Šæ•¸ `a` æŒ‡å‘çš„ `1` æ˜¯ä¸åŒçš„
    2. åœ¨ `function` å…§ç”¢ç”Ÿçš„ `1` å’Œ `2` æœƒéš¨è‘— `function` åŸ·è¡Œå®Œç•¢è€Œè¢« GC
    3. è®Šæ•¸ `p` å› ç‚ºæ˜¯å®£å‘Šåœ¨ `function` å…§ï¼Œå› æ­¤ç•¶ `function` åŸ·è¡Œå®Œç•¢æœƒè¢«éŠ·æ¯€

---
é€²éšé¡Œï¼Œç†è§£åŒæ™‚ assign (å¦‚ [jQuery](https://github.com/jquery/jquery/blob/1.6.2/jquery.js) çš„ `window.jQuery = window.$ = jQuery;` )

* Example 5
```js
var a = { x: 1 };
var b = a;
a.x = a = { x: 2 };
// b.x = ???
// a.x = ???
```

1. ç•«ä¸Šè®Šæ•¸ `a` ã€æŒ‡å‘çš„ç‰©ä»¶åŠç‰©ä»¶çš„å€¼
{% img inline /2016/11/26/js-value-reference/ex8-1.jpg %}

2. ç•«ä¸Šè®Šæ•¸ `b` ï¼Œä¸¦æŒ‡å‘è®Šæ•¸ `a` **æŒ‡å‘çš„ç‰©ä»¶**
{% img inline /2016/11/26/js-value-reference/ex8-2.jpg %}

3. å°‡ã€è®Šæ•¸ `a`ã€‘åŠã€è®Šæ•¸ `a` æŒ‡å‘çš„ç‰©ä»¶ `{ x: 1}` çš„è®Šæ•¸ `x`ã€‘åŒæ™‚æŒ‡å‘æ–°çš„ç‰©ä»¶ `{ x: 2 }`ï¼›è€ŒåŸæœ¬çš„ `1` å‰‡æœƒè¢« GC
{% img inline /2016/11/26/js-value-reference/ex8-3.jpg %}

4. æœ€å¾Œæ•´ç†ä¸€ä¸‹åœ–å½¢ï¼Œå³å¯å¾—çŸ¥ `b.x` æŒ‡å‘ `{ x: 2 }`ï¼Œè€Œ `a.x` å‰‡æ˜¯æŒ‡å‘ `2`
{% img inline /2016/11/26/js-value-reference/ex8-4.jpg %}

æ‰€è¬‚ "ä¸€åœ–æŠµè¬è¨€"ï¼Œé€éåœ–å½¢ç†è§£ JavaScript value referenceï¼Œå¯ä»¥é¿å…ç”¢ç”Ÿå¾ˆå¤šæ·ºåœ¨æ€§çš„ BUG (å³ç•¶ä½ æƒ³çš„è·ŸåŸ·è¡Œçš„ä¸ä¸€è‡´ ğŸ˜‚)